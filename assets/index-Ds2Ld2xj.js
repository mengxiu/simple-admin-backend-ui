var d=(S,t,r)=>new Promise((R,w)=>{var b=c=>{try{m(r.next(c))}catch(u){w(u)}},k=c=>{try{m(r.throw(c))}catch(u){w(u)}},m=c=>c.done?R(c.value):Promise.resolve(c.value).then(b,k);m((r=r.apply(S,t)).next())});import{u as J,_ as K}from"./useTable-C1zHh-l8.js";import{B as Q,a as Y,u as ee}from"./useForm-BzgFlAKs.js";import{v as oe,ar as te}from"./entry/index-BPNJPE-d-1727367563404.js";import{u as ae}from"./index-CaWdKrxn.js";import{g as ne,c as le,s as ie,u as se,_ as ce,d as re,a as E}from"./FileDrawer.vue_vue_type_script_setup_true_lang-sb_dLbpo.js";import{i as de}from"./index-D0CbPeO-.js";import{M as T,O as me}from"./antd-CnnxMtH0.js";import{d as ue,f as s,ae as M,S as O,a8 as pe,k as l,X as n,U as N,G as v,ac as h,u as o,Z as P,ab as $}from"./vue-D0RdBkD6.js";import"./index-LAC3wiAG.js";import"./isBoolean-Dou3jA6I.js";import"./index-BoOgNZ_b.js";import"./useWindowSizeFn-C71HDhub.js";import"./isDeepEqual-DIYWxe5x.js";import"./isNumber-j3SIk7av.js";import"./index-DDNUB-iW.js";import"./object-BY_VTB7H.js";import"./onMountedOrActivated-CyX9qi6i.js";import"./sortable.esm-BEDva30o.js";import"./index-DgmEQ_L6.js";import"./copyTextToClipboard-DU2l1C12.js";import"./useSortable-s3dauH_p.js";import"./index-BLETcaq3.js";import"./index-CBEN6l7B.js";import"./fileTag-BmLQAhlo.js";import"./ExclamationCircleOutlined-m2nOMvaL.js";const fe={width:"1280",height:"720",controls:""},ve=["src"],We=ue({name:"FileManagement",__name:"index",setup(S){const{t}=oe.useI18n(),{toClipboard:r}=ee(),{createErrorModal:R,createMessage:w}=te(),b=s(!1),k=s(),[m,{openDrawer:c}]=ae(),[u,{reload:U}]=J({title:t("fms.file.fileList"),api:ne,columns:le,formConfig:{labelWidth:120,schemas:ie},useSearchForm:!0,showTableSetting:!0,bordered:!0,clickToRowSelect:!1,showIndexColumn:!1,actionColumn:{width:50,title:t("common.action"),dataIndex:"action",fixed:void 0},rowKey:"id",rowSelection:{type:"checkbox",columnWidth:20,onChange:(e,a)=>{k.value=e,b.value=e.length>0}}}),B=s(!1),y=s(!1),g=s(!1),W=e=>{B.value=e},L=s(""),x=s(""),D=s(""),z=s(""),_=s("");function A(e){return d(this,null,function*(){let a=yield re(e.id,"none"),p=a.type.split("/")[0];if(_.value=e.name+"."+e.path.split(".")[1],p==="image")g.value=!0,L.value=URL.createObjectURL(a);else if(p==="video")y.value=!0,x.value=URL.createObjectURL(a),D.value=e.name;else{const i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=_.value,i.click(),i.remove(),URL.revokeObjectURL(i.href)}})}function V(){const e=document.createElement("a");e.href=x.value,e.download=_.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),F()}function I(){const e=document.createElement("a");e.href=L.value,e.download=_.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),j()}function F(){y.value=!1}function j(){g.value=!1}function G(e){c(!0,{record:e,isUpdate:!0})}function X(e){return d(this,null,function*(){yield E({ids:[e.id]}),yield U()})}function Z(){return d(this,null,function*(){T.confirm({title:t("common.deleteConfirm"),icon:l(de.ExclamationCircleOutlined),onOk(){return d(this,null,function*(){const a=k.value;(yield E({ids:a})).code===0&&(yield U())})},onCancel(){}})})}function q(e){return d(this,null,function*(){try{yield r(e.publicPath),w.success(t("fms.file.copyURLSuccess"))}catch(a){R({title:t("fms.file.copyURLFailed"),content:e.publicPath})}})}function H(){U()}return(e,a)=>{const p=M("Button"),i=M("a-button");return O(),pe("div",null,[l(o(K),{onRegister:o(u)},{tableTitle:n(()=>[b.value?(O(),N(p,{key:0,type:"primary",danger:"",preIcon:"ant-design:delete-outlined",onClick:Z},{default:n(()=>[v(h(o(t)("common.delete")),1)]),_:1})):P("",!0)]),toolbar:n(()=>[l(o(Q),{maxSize:1e3,maxNumber:10,api:o(se),multiple:!0,class:"my-5",accept:["image/*","video/*","audio/*"]},null,8,["api"])]),bodyCell:n(({column:f,record:C})=>[f.key==="action"?(O(),N(o(Y),{key:0,actions:[{icon:"ant-design:cloud-download-outlined",tooltip:o(t)("fms.file.download"),onClick:A.bind(null,C)},{icon:"ant-design:copy-outlined",tooltip:o(t)("fms.file.copyURL"),onClick:q.bind(null,C)},{icon:"clarity:note-edit-line",onClick:G.bind(null,C)},{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:o(t)("common.deleteConfirm"),placement:"left",confirm:X.bind(null,C)}}]},null,8,["actions"])):P("",!0)]),_:1},8,["onRegister"]),l(ce,{onRegister:o(m),onSuccess:H},null,8,["onRegister"]),l(o(T),{open:y.value,"onUpdate:open":a[0]||(a[0]=f=>y.value=f),title:D.value,width:"80%","wrap-class-name":"full-modal",onOk:V},{footer:n(()=>[l(i,{key:"back",onClick:F},{default:n(()=>[v(h(o(t)("common.closeText")),1)]),_:1}),l(i,{key:"download",type:"primary",onClick:V},{default:n(()=>[v(h(o(t)("fms.file.download")),1)]),_:1})]),default:n(()=>[$("video",fe,[$("source",{src:x.value,type:"video/mp4"},null,8,ve)])]),_:1},8,["open","title"]),l(o(T),{open:g.value,"onUpdate:open":a[1]||(a[1]=f=>g.value=f),title:z.value,width:"50%","wrap-class-name":"full-modal",onOk:I},{footer:n(()=>[l(i,{key:"back",onClick:j},{default:n(()=>[v(h(o(t)("common.closeText")),1)]),_:1}),l(i,{key:"download",type:"primary",onClick:I},{default:n(()=>[v(h(o(t)("fms.file.download")),1)]),_:1})]),default:n(()=>[l(o(me),{width:"100%",style:{},preview:{visible:B.value,onVisibleChange:W},src:L.value},null,8,["preview","src"])]),_:1},8,["open","title"])])}}});export{We as default};
