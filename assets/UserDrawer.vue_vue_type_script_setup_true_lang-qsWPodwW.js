var _=Object.defineProperty;var g=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var b=(s,t,a)=>t in s?_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,h=(s,t)=>{for(var a in t||(t={}))A.call(t,a)&&b(s,a,t[a]);if(g)for(var a of g(t))D.call(t,a)&&b(s,a,t[a]);return s};var f=(s,t,a)=>new Promise((o,i)=>{var d=r=>{try{u(a.next(r))}catch(m){i(m)}},c=r=>{try{u(a.throw(r))}catch(m){i(m)}},u=r=>r.done?o(r.value):Promise.resolve(r.value).then(d,c);u((a=a.apply(s,t)).next())});import{b as q,c as C}from"./useForm-BzgFlAKs.js";import{b as R,bu as w,as as T,ar as y,v as U,bv as L}from"./entry/index-BPNJPE-d-1727367563404.js";import{g as I}from"./role-DKToNsWF.js";import{g as B}from"./department-BDAUZ4eN.js";import{g as M}from"./position-C1YWIXu5.js";import{u as V}from"./cloudFile-BHp2dcVw.js";import{l as z,d as G,f as $,c as j,u as l,S as N,U as O,X as Q,k as W,a0 as X}from"./vue-D0RdBkD6.js";import{Q as E}from"./antd-CnnxMtH0.js";import{a as H,B as J}from"./index-CaWdKrxn.js";const{t:e}=R(),re=[{title:e("sys.login.username"),dataIndex:"username",width:30},{title:e("sys.user.nickname"),dataIndex:"nickname",width:30},{title:e("sys.login.email"),dataIndex:"email",width:50},{title:e("common.status"),dataIndex:"status",width:20,customRender:({record:s})=>(Reflect.has(s,"pendingStatus")||(s.pendingStatus=!1),z(E,{checked:s.status===1,checkedChildren:e("common.on"),unCheckedChildren:e("common.off"),loading:s.pendingStatus,onChange(t,a){const{createMessage:o}=y();if(s.id==1){o.warn(e("sys.role.adminStatusChangeForbidden"));return}s.pendingStatus=!0;const i=t?1:2;w({id:s.id,status:i}).then(()=>{s.status=i}).finally(()=>{s.pendingStatus=!1})}}))},{title:e("common.createTime"),dataIndex:"createdAt",width:40,customRender:({record:s})=>T(s.createdAt)}],ue=[{field:"username",label:e("sys.login.username"),component:"Input",colProps:{span:8},rules:[{max:50}]},{field:"nickname",label:e("sys.user.nickname"),component:"Input",colProps:{span:8},rules:[{max:40}]},{field:"roleIds",label:e("sys.role.roleTitle"),component:"ApiMultipleSelect",componentProps:{api:I,params:{page:1,pageSize:100},resultField:"data.data",labelField:"trans",valueField:"id"},colProps:{span:8}},{field:"mobile",label:e("sys.login.mobile"),component:"Input",colProps:{span:8},rules:[{max:18}]},{field:"email",label:e("sys.login.email"),component:"Input",colProps:{span:8},rules:[{max:70}]}],K=[{field:"avatar",label:e("sys.user.avatar"),defaultValue:"",component:"CropperAvatar",show:!0,componentProps:{uploadApi:V,btnText:e("sys.user.changeAvatar"),width:100,formValueType:"string"}},{field:"id",label:"ID",component:"Input",show:!1},{field:"username",label:e("sys.login.username"),required:!0,component:"Input",rules:[{max:50}]},{field:"nickname",label:e("sys.user.nickname"),required:!0,component:"Input",rules:[{max:40}]},{field:"description",label:e("sys.user.description"),required:!1,component:"Input",rules:[{max:100}]},{field:"homePath",label:e("sys.user.homePath"),required:!1,defaultValue:"/dashboard",component:"Input",rules:[{max:70}]},{field:"mobile",label:e("sys.login.mobile"),component:"Input",rules:[{max:18}]},{field:"email",label:e("sys.login.email"),required:!0,component:"Input",rules:[{type:"email"}]},{field:"password",label:e("sys.login.password"),component:"Input"},{field:"roleIds",label:e("sys.role.roleTitle"),required:!0,component:"ApiMultipleSelect",componentProps:{api:I,params:{page:1,pageSize:100},resultField:"data.data",labelField:"trans",valueField:"id"}},{field:"departmentId",label:e("sys.department.userDepartment"),component:"ApiTreeSelect",required:!0,componentProps:{api:B,params:{page:1,pageSize:1e3},resultField:"data.data",labelField:"trans",valueField:"id"}},{field:"positionId",label:e("sys.position.userPosition"),component:"ApiMultipleSelect",required:!0,componentProps:{api:M,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"trans",valueField:"id"}},{field:"status",label:e("common.status"),component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:e("common.on"),value:1},{label:e("common.off"),value:2}]}}],me=G({__name:"UserDrawer",emits:["success","register"],setup(s,{emit:t}){const a=t,o=$(!0),{t:i}=U.useI18n(),{createMessage:d}=y(),[c,{resetFields:u,setFieldsValue:r,validate:m,updateSchema:S}]=q({labelWidth:160,baseColProps:{span:24},layout:"vertical",schemas:K,showActionButtonGroup:!1}),[v,{setDrawerProps:p,closeDrawer:F}]=H(n=>f(this,null,function*(){yield u(),p({confirmLoading:!1}),o.value=!!(n!=null&&n.isUpdate),l(o)&&(yield r(h({},n.record))),yield S({field:"password",required:!l(o)})})),P=j(()=>l(o)?i("sys.user.editUser"):i("sys.user.addUser"));function x(){return f(this,null,function*(){const n=yield m();if(p({confirmLoading:!0}),!l(o)&&n.password===void 0){d.warning(i("sys.login.passwordPlaceholder")),p({confirmLoading:!1});return}n.id=l(o)?n.id:"",(l(o)?yield w(n):yield L(n)).code===0&&(F(),a("success")),p({confirmLoading:!1})})}return(n,k)=>(N(),O(l(J),X(n.$attrs,{onRegister:l(v),showFooter:"",title:P.value,width:"35%",onOk:x}),{default:Q(()=>[W(l(C),{onRegister:l(c)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{me as _,re as c,ue as s};
