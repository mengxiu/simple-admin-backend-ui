var p=(D,t,d)=>new Promise((y,h)=>{var g=s=>{try{r(d.next(s))}catch(v){h(v)}},k=s=>{try{r(d.throw(s))}catch(v){h(v)}},r=s=>s.done?y(s.value):Promise.resolve(s.value).then(g,k);r((d=d.apply(D,t)).next())});import{u as Q,_ as Y}from"./useTable-C1zHh-l8.js";import{_ as ee,B as oe,a as ae,u as te}from"./useForm-BzgFlAKs.js";import{v as le,aq as ne,ar as ie}from"./entry/index-BPNJPE-d-1727367563404.js";import{u as se}from"./index-CaWdKrxn.js";import{c as re,s as ce,_ as ue}from"./CloudFileDrawer.vue_vue_type_script_setup_true_lang-DhtK_jMw.js";import{g as de,u as me,d as P}from"./cloudFile-BHp2dcVw.js";import{i as pe}from"./index-D0CbPeO-.js";import"./index-LAC3wiAG.js";import{M as S,O as fe}from"./antd-CnnxMtH0.js";import"./index-BoOgNZ_b.js";import{g as ve}from"./storageProvider-CFOQ3JK-.js";import{d as he,f as i,c as ge,ae as ke,S as T,a8 as we,k as l,X as n,U as M,u as o,G as f,ac as u,Z as j,ab as L}from"./vue-D0RdBkD6.js";import"./isBoolean-Dou3jA6I.js";import"./isNumber-j3SIk7av.js";import"./index-DDNUB-iW.js";import"./object-BY_VTB7H.js";import"./isDeepEqual-DIYWxe5x.js";import"./useWindowSizeFn-C71HDhub.js";import"./onMountedOrActivated-CyX9qi6i.js";import"./sortable.esm-BEDva30o.js";import"./index-DgmEQ_L6.js";import"./copyTextToClipboard-DU2l1C12.js";import"./useSortable-s3dauH_p.js";import"./index-BLETcaq3.js";import"./index-CBEN6l7B.js";import"./cloudFileTag-Df3Nxs6P.js";import"./ExclamationCircleOutlined-m2nOMvaL.js";const Ce={width:"1280",height:"720",controls:""},be=["src"],Je=he({name:"CloudFileManagement",__name:"index",setup(D){const{t}=le.useI18n(),{toClipboard:d}=te(),{createErrorModal:y,createMessage:h}=ie(),g=i(!1),k=i(),r=i(t("fms.storageProvider.chooseProvider")),s=ge(()=>({provider:r.value})),[v,{openDrawer:F}]=se(),[$,{reload:_}]=Q({title:t("fms.file.fileList"),api:de,columns:re,formConfig:{labelWidth:140,schemas:ce},useSearchForm:!0,showTableSetting:!0,bordered:!0,clickToRowSelect:!1,showIndexColumn:!1,actionColumn:{width:50,title:t("common.action"),dataIndex:"action",fixed:void 0},rowKey:"id",rowSelection:{type:"checkbox",columnWidth:20,onChange:(e,a)=>{k.value=e,g.value=e.length>0}}}),I=i(!1),w=i(!1),C=i(!1),z=e=>{I.value=e},U=i(""),x=i(""),O=i(""),W=i(""),R=i("");function q(){F(!0,{isUpdate:!1})}function A(e){for(let a=0;a<e.length;a++)if(e[a].isDefault){r.value=e[a].label;break}}function G(e){return p(this,null,function*(){if(e.fileType===2)C.value=!0,U.value=e.url;else if(e.fileType===3)w.value=!0,x.value=e.url,O.value=e.name;else{const a=document.createElement("a");a.href=e.url,a.download=R.value,a.click(),a.remove(),URL.revokeObjectURL(a.href)}})}function V(){const e=document.createElement("a");e.href=x.value,e.download=R.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),E()}function B(){const e=document.createElement("a");e.href=U.value,e.download=R.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),N()}function E(){w.value=!1}function N(){C.value=!1}function X(e){F(!0,{record:e,isUpdate:!0})}function Z(e){return p(this,null,function*(){yield P({ids:[e.id]}),yield _()})}function H(){return p(this,null,function*(){S.confirm({title:t("common.deleteConfirm"),icon:l(pe.ExclamationCircleOutlined),onOk(){return p(this,null,function*(){const a=k.value;(yield P({ids:a})).code===0&&(yield _())})},onCancel(){}})})}function J(e){return p(this,null,function*(){try{yield d(e.url),h.success(t("fms.file.copyURLSuccess"))}catch(a){y({title:t("fms.file.copyURLFailed"),content:e.publicPath})}})}function K(){_()}return(e,a)=>{const m=ke("a-button");return T(),we("div",null,[l(o(Y),{onRegister:o($)},{tableTitle:n(()=>[g.value?(T(),M(o(ne),{key:0,type:"primary",danger:"",preIcon:"ant-design:delete-outlined",onClick:H},{default:n(()=>[f(u(o(t)("common.delete")),1)]),_:1})):j("",!0)]),toolbar:n(()=>[L("span",null,u(o(t)("fms.cloudFile.providerId")),1),l(o(ee),{api:o(ve),params:{page:1,pageSize:1e3},"result-field":"data.data","label-field":"name","value-field":"name",class:"w-32",value:r.value,"onUpdate:value":a[0]||(a[0]=c=>r.value=c),onOptionsChange:A},null,8,["api","value"]),l(o(oe),{maxSize:1e3,maxNumber:10,api:o(me),"upload-params":s.value,multiple:!0,class:"my-5",accept:["image/*","video/*","audio/*"]},null,8,["api","upload-params"]),l(m,{type:"primary",onClick:q},{default:n(()=>[f(u(o(t)("fms.cloudFile.addCloudFile")),1)]),_:1})]),bodyCell:n(({column:c,record:b})=>[c.key==="action"?(T(),M(o(ae),{key:0,actions:[{icon:"ant-design:cloud-download-outlined",tooltip:o(t)("fms.file.download"),onClick:G.bind(null,b)},{icon:"ant-design:copy-outlined",tooltip:o(t)("fms.file.copyURL"),onClick:J.bind(null,b)},{icon:"clarity:note-edit-line",onClick:X.bind(null,b)},{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:o(t)("common.deleteConfirm"),placement:"left",confirm:Z.bind(null,b)}}]},null,8,["actions"])):j("",!0)]),_:1},8,["onRegister"]),l(ue,{onRegister:o(v),onSuccess:K},null,8,["onRegister"]),l(o(S),{open:w.value,"onUpdate:open":a[1]||(a[1]=c=>w.value=c),title:O.value,width:"80%","wrap-class-name":"full-modal",onOk:V},{footer:n(()=>[l(m,{key:"back",onClick:E},{default:n(()=>[f(u(o(t)("common.closeText")),1)]),_:1}),l(m,{key:"download",type:"primary",onClick:V},{default:n(()=>[f(u(o(t)("fms.file.download")),1)]),_:1})]),default:n(()=>[L("video",Ce,[L("source",{src:x.value,type:"video/mp4"},null,8,be)])]),_:1},8,["open","title"]),l(o(S),{open:C.value,"onUpdate:open":a[2]||(a[2]=c=>C.value=c),title:W.value,width:"50%","wrap-class-name":"full-modal",onOk:B},{footer:n(()=>[l(m,{key:"back",onClick:N},{default:n(()=>[f(u(o(t)("common.closeText")),1)]),_:1}),l(m,{key:"download",type:"primary",onClick:B},{default:n(()=>[f(u(o(t)("fms.file.download")),1)]),_:1})]),default:n(()=>[l(o(fe),{width:"100%",style:{},preview:{visible:I.value,onVisibleChange:z},src:U.value},null,8,["preview","src"])]),_:1},8,["open","title"])])}}});export{Je as default};
