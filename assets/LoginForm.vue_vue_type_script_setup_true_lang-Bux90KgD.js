var v=(F,f,g)=>new Promise((i,S)=>{var T=s=>{try{p(g.next(s))}catch(y){S(y)}},h=s=>{try{p(g.throw(s))}catch(y){S(y)}},p=s=>s.done?i(s.value):Promise.resolve(s.value).then(T,h);p((g=g.apply(F,f)).next())});import{d as K,f as z,c as G,r as W,u as e,S as m,a8 as X,m as B,A as P,k as l,X as o,ab as O,G as u,ac as d,U as w,Z as x,a9 as j,al as Q,F as Y}from"./vue-D0RdBkD6.js";import{u as Z,a as J,L as b,b as ee,c as ae}from"./LoginFormTitle-DbclMKkX.js";import{u as se,b as te,f as le,c as oe,P as _}from"./entry/index-BPNJPE-d-1727367563404.js";import{g as ne,a as re,b as ie}from"./captcha-C5BMDrvC.js";import{a as ce}from"./oauthProvider-C_-oTPvK.js";import{C as ue}from"./index-DgmEQ_L6.js";import{U as H,I as C,O as de,B as k,n as pe,V as ge,W as me,p as fe,R as he,X as ye,Y as ve}from"./antd-CnnxMtH0.js";const we={class:"pt-4 pb-4"},Ee=K({__name:"LoginForm",setup(F){const f=fe,g=he,i=H.Item,S=C.Password,T=ye,h=ve,p=se(),{t:s}=te(),{prefixCls:y}=le("login"),I=oe(),{setLoginState:R,getLoginState:N}=Z(),{getFormRules:$}=J(),L=z(),c=z(!1),V=G(()=>a.msgType==="email"?s("sys.login.emailPlaceholder"):s("sys.login.mobilePlaceholder")),a=W({msgType:"captcha",account:"",password:"",captcha:"",captchaId:"",imgPath:"",target:"",captchaVerified:""}),{validForm:q}=ae(L),U=G(()=>e(N)===b.LOGIN);function A(){return v(this,null,function*(){const n=yield q();n&&(c.value=!0,a.msgType==="captcha"?I.login({password:n.password,username:n.account,captcha:n.captcha,captchaId:n.captchaId,goHome:!1,mode:"notice"}).then(()=>{c.value=!1,p(_.BASE_HOME)}).catch(()=>{E(),c.value=!1}):a.msgType==="email"?I.loginByEmail({captcha:n.captchaVerified,email:n.target,goHome:!1,mode:"notice"}).then(()=>{c.value=!1,p(_.BASE_HOME)}).catch(()=>{c.value=!1}):a.msgType==="sms"&&I.loginBySms({captcha:n.captchaVerified,phoneNumber:n.target,goHome:!1,mode:"notice"}).then(()=>{c.value=!1,p(_.BASE_HOME)}).catch(()=>{c.value=!1}))})}function E(){return v(this,null,function*(){const n=yield ne("none");n.code===0&&(a.captchaId=n.data.captchaId,a.imgPath=n.data.imgPath)})}function M(){return v(this,null,function*(){return a.msgType=="email"?(yield re({email:a.target})).code==0:(yield ie({phoneNumber:a.target})).code==0})}E();function D(n){return v(this,null,function*(){const t=yield ce({state:new Date().getMilliseconds()+"-"+n,provider:n});t.code===0&&window.open(t.data.URL)})}return(n,t)=>(m(),X(Y,null,[B(l(ee,{class:"enter-x"},null,512),[[P,U.value]]),B(l(e(H),{class:"p-4 enter-x",model:a,rules:e($),ref_key:"formRef",ref:L,onKeypress:Q(A,["enter"])},{default:o(()=>[O("div",we,[l(e(T),{value:a.msgType,"onUpdate:value":t[0]||(t[0]=r=>a.msgType=r),"button-style":"solid",size:"large"},{default:o(()=>[l(e(h),{class:"bg-transparent",value:"captcha"},{default:o(()=>[u(d(e(s)("sys.login.captcha")),1)]),_:1}),l(e(h),{class:"bg-transparent",value:"email"},{default:o(()=>[u(d(e(s)("sys.login.email")),1)]),_:1}),l(e(h),{class:"bg-transparent",value:"sms"},{default:o(()=>[u(d(e(s)("sys.login.mobile")),1)]),_:1})]),_:1},8,["value"])]),a.msgType!=="captcha"?(m(),w(e(i),{key:0,name:"target",class:"enter-x"},{default:o(()=>[l(e(C),{size:"large",value:a.target,"onUpdate:value":t[1]||(t[1]=r=>a.target=r),placeholder:V.value,"onUpdate:placeholder":t[2]||(t[2]=r=>V.value=r)},null,8,["value","placeholder"])]),_:1})):x("",!0),a.msgType!=="captcha"?(m(),w(e(i),{key:1,name:"captchaVerified",class:"enter-x"},{default:o(()=>[l(e(ue),{size:"large",value:a.captchaVerified,"onUpdate:value":t[3]||(t[3]=r=>a.captchaVerified=r),count:60,placeholder:e(s)("sys.login.captcha"),"send-code-api":M},null,8,["value","placeholder"])]),_:1})):x("",!0),a.msgType==="captcha"?(m(),w(e(i),{key:2,name:"account",class:"enter-x",rules:[{required:!0,message:e(s)("sys.login.accountPlaceholder")},{max:30,message:e(s)("sys.login.accountMaxLength")}]},{default:o(()=>[l(e(C),{size:"large",value:a.account,"onUpdate:value":t[4]||(t[4]=r=>a.account=r),placeholder:e(s)("sys.login.username"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1},8,["rules"])):x("",!0),a.msgType==="captcha"?(m(),w(e(i),{key:3,name:"password",class:"enter-x",rules:[{required:!0,message:e(s)("sys.login.passwordPlaceholder")},{min:6,max:30,message:e(s)("sys.login.passwordLength")}]},{default:o(()=>[l(e(S),{size:"large",visibilityToggle:"",value:a.password,"onUpdate:value":t[5]||(t[5]=r=>a.password=r),placeholder:e(s)("sys.login.password"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1},8,["rules"])):x("",!0),a.msgType==="captcha"?(m(),w(e(i),{key:4,name:"captcha",class:"enter-x",rules:[{required:!0,len:5,message:e(s)("sys.login.captchaRequired")}]},{default:o(()=>[l(e(C),{size:"large",value:a.captcha,"onUpdate:value":t[6]||(t[6]=r=>a.captcha=r),placeholder:e(s)("sys.login.captcha"),class:"fix-auto-fill bg-transparent"},{suffix:o(()=>[l(e(de),{src:a.imgPath,width:120,height:40,preview:!1,onClick:E,class:"rounded"},null,8,["src"])]),_:1},8,["value","placeholder"])]),_:1},8,["rules"])):x("",!0),B(l(e(i),{name:"captchaId",class:"enter-x"},{default:o(()=>[l(e(C),{value:a.captchaId},null,8,["value"])]),_:1},512),[[P,!1]]),l(e(i),{class:"enter-x"},{default:o(()=>[l(e(k),{type:"primary",size:"large",block:"",onClick:A,loading:c.value},{default:o(()=>[u(d(e(s)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),l(e(g),{class:"enter-x",gutter:5},{default:o(()=>[l(e(f),{md:8,xs:24},{default:o(()=>[l(e(k),{block:"",onClick:t[7]||(t[7]=r=>e(R)(e(b).QR_CODE))},{default:o(()=>[u(d(e(s)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),l(e(f),{md:8,xs:24},{default:o(()=>[l(e(k),{block:"",onClick:t[8]||(t[8]=r=>e(R)(e(b).REGISTER))},{default:o(()=>[u(d(e(s)("sys.login.registerButton")),1)]),_:1})]),_:1}),l(e(f),{md:8,xs:24},{default:o(()=>[l(e(k),{block:"",onClick:t[9]||(t[9]=r=>e(R)(e(b).RESET_PASSWORD))},{default:o(()=>[u(d(e(s)("sys.login.forgetFormTitle")),1)]),_:1})]),_:1})]),_:1}),l(e(pe),{class:"enter-x"},{default:o(()=>[u(d(e(s)("sys.login.otherSignIn")),1)]),_:1}),O("div",{class:j(["flex justify-evenly enter-x",`${e(y)}-sign-in-way`])},[l(e(ge),{onClick:t[10]||(t[10]=r=>D("github"))}),l(e(me),{onClick:t[11]||(t[11]=r=>D("google"))})],2)]),_:1},8,["model","rules"]),[[P,U.value]])],64))}});export{Ee as _};
