var s=(p,t,i)=>new Promise((g,c)=>{var _=n=>{try{l(i.next(n))}catch(m){c(m)}},h=n=>{try{l(i.throw(n))}catch(m){c(m)}},l=n=>n.done?g(n.value):Promise.resolve(n.value).then(_,h);l((i=i.apply(p,t)).next())});import{i as O}from"./index-D0CbPeO-.js";import{u as $,_ as N}from"./useTable-C1zHh-l8.js";import{a as V}from"./useForm-BzgFlAKs.js";import{_ as W}from"./DeptTree.vue_vue_type_script_setup_true_lang-zk2ZxHhW.js";import{u as E}from"./index-CaWdKrxn.js";import{c as P,s as X,_ as j}from"./UserDrawer.vue_vue_type_script_setup_true_lang-qsWPodwW.js";import{v as q,bw as z,aq as G,bx as b,ar as H}from"./entry/index-BPNJPE-d-1727367563404.js";import{a3 as Y,d as Z,f as I,r as J,ae as K,S as w,U as y,X as a,k as r,u as e,G as D,ac as k,Z as x}from"./vue-D0RdBkD6.js";import{g as Q}from"./role-DKToNsWF.js";import{l as ee}from"./token-D0LMf3U-.js";import{aX as te,aY as R,M as oe}from"./antd-CnnxMtH0.js";import{P as ae}from"./index-CU2O72Tc.js";import"./ExclamationCircleOutlined-m2nOMvaL.js";import"./index-LAC3wiAG.js";import"./isBoolean-Dou3jA6I.js";import"./index-BoOgNZ_b.js";import"./useWindowSizeFn-C71HDhub.js";import"./isDeepEqual-DIYWxe5x.js";import"./isNumber-j3SIk7av.js";import"./index-DDNUB-iW.js";import"./object-BY_VTB7H.js";import"./onMountedOrActivated-CyX9qi6i.js";import"./sortable.esm-BEDva30o.js";import"./index-DgmEQ_L6.js";import"./copyTextToClipboard-DU2l1C12.js";import"./useSortable-s3dauH_p.js";import"./index-BLETcaq3.js";import"./index-CBEN6l7B.js";import"./department-BDAUZ4eN.js";import"./position-C1YWIXu5.js";import"./cloudFile-BHp2dcVw.js";import"./useContentViewHeight-b3bBSljJ.js";const ne=Y("app-role",{state:()=>({roleInfo:[]}),getters:{getRoleInfo(){return this.roleInfo}},actions:{getRoleInfoFromServer(){return s(this,null,function*(){const p=yield Q({page:1,pageSize:1e3});this.roleInfo=p.data.data})}}}),Ne=Z({name:"UserManagement",__name:"index",setup(p){const{t}=q.useI18n(),{createMessage:i}=H(),g=I(),c=I(!1),_=J({}),[h,{openDrawer:l}]=E();ne().getRoleInfoFromServer();const[m,{reload:u,getSelectRows:v}]=$({title:t("sys.user.userList"),api:z,columns:P,formConfig:{labelWidth:120,schemas:X},useSearchForm:!0,showTableSetting:!0,bordered:!0,showIndexColumn:!1,clickToRowSelect:!1,actionColumn:{width:30,title:t("common.action"),dataIndex:"action",fixed:void 0},rowKey:"id",rowSelection:{type:"checkbox",columnWidth:20,onChange:(o,d)=>{g.value=o,c.value=o.length>0}}});function U(){l(!0,{isUpdate:!1})}function L(o){l(!0,{record:o,isUpdate:!0})}function T(o){return s(this,null,function*(){if(o.nickname==="admin"){i.warn(t("common.notAllowDeleteAdminData"));return}(yield b({ids:[o.id]})).code===0&&(yield u())})}function A(){return s(this,null,function*(){oe.confirm({title:t("common.deleteConfirm"),icon:r(O.ExclamationCircleOutlined),onOk(){return s(this,null,function*(){const d=g.value;if(v().filter(f=>f.nickname==="admin").length>0){i.warn(t("common.notAllowDeleteAdminData"));return}(yield b({ids:d})).code===0&&(yield u())})},onCancel(){}})})}function B(o){_.departmentId=o,u()}function F(o){return s(this,null,function*(){(yield ee(o.id)).code===0&&(yield u())})}function M(){return s(this,null,function*(){yield u()})}return(o,d)=>{const C=K("a-button");return w(),y(e(ae),{dense:"",contentFullHeight:""},{default:a(()=>[r(e(te),null,{default:a(()=>[r(e(R),{span:5},{default:a(()=>[r(W,{onSelect:B})]),_:1}),r(e(R),{span:19},{default:a(()=>[r(e(N),{onRegister:e(m),searchInfo:_},{tableTitle:a(()=>[c.value?(w(),y(e(G),{key:0,type:"primary",danger:"",preIcon:"ant-design:delete-outlined",onClick:A},{default:a(()=>[D(k(e(t)("common.delete")),1)]),_:1})):x("",!0)]),toolbar:a(()=>[r(C,{type:"primary",onClick:U},{default:a(()=>[D(k(e(t)("sys.user.addUser")),1)]),_:1})]),bodyCell:a(({column:S,record:f})=>[S.key==="action"?(w(),y(e(V),{key:0,actions:[{icon:"clarity:note-edit-line",onClick:L.bind(null,f)},{icon:"bx:log-out-circle",color:"error",tooltip:e(t)("sys.user.forceLoggingOut"),popConfirm:{title:e(t)("sys.user.forceLoggingOut")+"?",placement:"left",confirm:F.bind(null,f)}},{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:e(t)("common.deleteConfirm"),placement:"left",confirm:T.bind(null,f)}}]},null,8,["actions"])):x("",!0)]),_:1},8,["onRegister","searchInfo"])]),_:1})]),_:1}),r(j,{onRegister:e(h),onSuccess:M},null,8,["onRegister"])]),_:1})}}});export{Ne as default};
