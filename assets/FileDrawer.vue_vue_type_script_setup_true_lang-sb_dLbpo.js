var I=Object.defineProperty;var h=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var w=(e,s,a)=>s in e?I(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,F=(e,s)=>{for(var a in s||(s={}))y.call(s,a)&&w(e,a,s[a]);if(h)for(var a of h(s))T.call(s,a)&&w(e,a,s[a]);return e};var g=(e,s,a)=>new Promise((l,f)=>{var p=i=>{try{u(a.next(i))}catch(m){f(m)}},d=i=>{try{u(a.throw(i))}catch(m){f(m)}},u=i=>i.done?l(i.value):Promise.resolve(i.value).then(p,d);u((a=a.apply(e,s)).next())});import{b as _,c as P}from"./useForm-BzgFlAKs.js";import{a as r,b as x,as as R,v as z}from"./entry/index-BPNJPE-d-1727367563404.js";import{g as b}from"./fileTag-BmLQAhlo.js";import{l as k,d as B,f as D,c as C,u as n,S as A,U as L,X as N,k as U,a0 as V}from"./vue-D0RdBkD6.js";import{Q as G}from"./antd-CnnxMtH0.js";import{a as $,B as j}from"./index-CaWdKrxn.js";function ee(e,s){return r.uploadFile({url:"/fms-api/upload",onUploadProgress:s},e)}const se=(e,s="notice")=>r.post({url:"/fms-api/file/list",params:e},{errorMessageMode:s,successMessageMode:"none"}),q=(e,s="notice")=>r.post({url:"/fms-api/file/update",params:e},{errorMessageMode:s,successMessageMode:s}),te=(e,s="notice")=>r.post({url:"/fms-api/file/delete",params:e},{errorMessageMode:s,successMessageMode:s}),H=(e,s,a="notice")=>r.post({url:"/fms-api/file/status",params:{id:e,status:s}},{errorMessageMode:a,successMessageMode:a}),ae=(e,s="none")=>r.get({url:"/fms-api/file/download/"+e,responseType:"blob"},{errorMessageMode:s}),{t}=x(),ie=[{title:t("fms.file.fileName"),dataIndex:"name",width:50},{title:t("fms.file.fileType"),dataIndex:"fileType",width:20,customRender:({record:e})=>e.fileType==="video"?t("fms.file.video"):e.fileType==="audio"?t("fms.file.audio"):e.fileType==="image"?t("fms.file.image"):t("fms.file.other")},{title:t("common.status"),dataIndex:"status",width:20,customRender:({record:e})=>(Reflect.has(e,"pendingStatus")||(e.pendingStatus=!1),k(G,{checked:e.status===1,checkedChildren:t("fms.file.public"),unCheckedChildren:t("fms.file.private"),loading:e.pendingStatus,onChange(s,a){e.pendingStatus=!0;const l=s?1:0;H(e.id,l).then(()=>{e.status=l}).finally(()=>{e.pendingStatus=!1})}}))},{title:t("fms.file.filePath"),dataIndex:"path",width:40},{title:t("fms.file.fileSize"),dataIndex:"size",width:20,customRender:({record:e})=>e.size>1073741824?(e.size/1073741824).toFixed(2)+"GB":e.size>1048576?(e.size/1048576).toFixed(2)+"MB":(e.size/1024).toFixed(2)+"KB"},{title:t("common.createTime"),dataIndex:"createdAt",width:30,customRender:({record:e})=>R(e.createdAt)}],le=[{field:"fileType",label:t("fms.file.fileType"),colProps:{span:8},component:"Select",defaultValue:0,componentProps:{options:[{label:t("common.all"),value:0},{label:t("fms.file.other"),value:1},{label:t("fms.file.image"),value:2},{label:t("fms.file.video"),value:3},{label:t("fms.file.audio"),value:4}]}},{field:"fileName",label:t("fms.file.fileName"),defaultValue:"",component:"Input",colProps:{span:8}},{field:"tagIds",label:t("fms.tag.tag"),component:"ApiMultipleSelect",componentProps:{api:b,params:{page:1,pageSize:1e3,status:1},resultField:"data.data",labelField:"name",valueField:"id"},colProps:{span:8}},{field:"period",label:t("common.createTime"),component:"RangePicker",colProps:{span:8}}],K=[{field:"id",label:"ID",component:"Input",show:!1},{field:"name",label:t("fms.file.fileName"),required:!0,component:"Input"},{field:"tagIds",label:t("fms.tag.tag"),component:"ApiMultipleSelect",componentProps:{api:b,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"name",valueField:"id"}}],oe=B({__name:"FileDrawer",emits:["success","register"],setup(e,{emit:s}){const a=s,l=D(!0),{t:f}=z.useI18n(),[p,{resetFields:d,setFieldsValue:u,validate:i}]=_({labelWidth:160,baseColProps:{span:24},layout:"vertical",schemas:K,showActionButtonGroup:!1}),[m,{setDrawerProps:c,closeDrawer:M}]=$(o=>g(this,null,function*(){yield d(),c({confirmLoading:!1}),l.value=!!(o!=null&&o.isUpdate),n(l)&&(yield u(F({},o.record)))})),v=C(()=>n(l)?f("fms.file.editFile"):f("fms.file.addFile"));function S(){return g(this,null,function*(){try{const o=yield i();c({confirmLoading:!0}),yield q(o),M(),a("success")}finally{c({confirmLoading:!1})}})}return(o,O)=>(A(),L(n(j),V(o.$attrs,{onRegister:n(m),showFooter:"",title:v.value,width:"35%",onOk:S}),{default:N(()=>[U(n(P),{onRegister:n(p)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{oe as _,te as a,ie as c,ae as d,se as g,le as s,ee as u};
